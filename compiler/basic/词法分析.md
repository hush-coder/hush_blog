***compiler-basic 词法分析***

# 目录

# 字符流到令牌流

字符流转为token流，token主要分为以下几个部分：

- **Token 类型**：如 IDENT, INT, FLOAT, IF, WHILE, PLUS 等
- **词素（Lexeme）**：在源码中实际出现的字串，例如 sum、123
- **属性（Attribute）**：额外信息

## 典型 Token 分类

- 关键字：if, else, while, return …
- 标识符：变量名、函数名、类型名等
- 字面量：整型、浮点、字符串、字符、布尔等等
- 运算符：+ - * / % == != <= >= && || << >> …
- 分隔符：(, ), {, }, ,, ; 等
- 特殊 Token：EOF（文件结束），有时还会有 ERROR Token

## 最终示例

```
[IDENTIFIER, "position"] [ASSIGN_OP] [IDENTIFIER, "initial"] [ADD_OP] [IDENTIFIER, "rate"] [MULT_OP] [INTEGER_LITERAL, 60]
```

# 有限状态自动机

## 正则表达式

1. 首先，定义一个通用的标识符规则：`[a-zA-Z_][a-zA-Z_0-9]*`。

2. 识别出一个标识符后，去一个预先构建好的**关键字表**（哈希表）中进行查找。

3. 如果查到了，就生成一个**关键字令牌**；如果没查到，就生成一个**标识符令牌**。

## 状态转移表


当前状态 | 输入字符是字母 | 输入字符是数字 | 输入字符是其他
| :--- | :--- | :--- | :--- |
状态0 (初始) | 去状态1 | 去状态2 | 错误
状态1 (识别标识符) | 保持在状态1 | 保持在状态1 | 回退，生成标识符令牌
状态2 (识别整数) | 错误 | 保持在状态2 | 回退，生成整数令牌

## 最大匹配原则

当词法分析器发现一段字符流可以匹配多种令牌规则时，它会选择匹配最长的那个令牌。

## 向前看

为了确定当前令牌的结束，词法分析器可能需要多读取一个或几个字符。

**回退操作**：在生成令牌后，将多读取的字符（向前看的字符）退回到输入流中，以便下一个令牌可以正确开始识别。这是实现向前看的关键机制。

# 错误处理与恢复

## 常见错误

- 非法字符
- 未结束的字符串/注释
- 不符合规则的数字

## 处理方式

- 报告错误
- 进入错误状态：进入一个专门的错误处理状态。
- 尝试恢复：最简单的策略是恐慌模式恢复：跳过所有字符，直到找到一个能作为新令牌开始的“同步字符”（例如分号、空格、换行等），然后重置状态机，继续分析。