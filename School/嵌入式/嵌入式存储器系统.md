# 嵌入式存储器的类型

## 按用途分类

- 主存储器
- 辅助存储器

## 按存储介质分类

- 半导体存储器（使用最广泛）
- 光盘存储器（主要用作辅存）
- 磁表面存储器（主要用作辅存）

## 按存取方式分类

### 随机存取存储器RAM

- **静态随机存取存储器SRAM**：速度快，功耗大，可长时间保持
- **动态随机存取存储器DRAM**：速度慢一点，功耗小，需周期性刷新
- **同步动态随机存取存储器SDRAM**：与CPU和RAM共享一个时钟周期，每个时钟脉冲的上升沿开始传输数据
- **双倍数据速率动态随机存取存储器DDR** SDRAM：允许在时钟脉冲的上升沿和下降沿两次传输数据。

### 只读存储器ROM

- 掩膜只读存储器MROM：成本低
- 可编程只读存储器PROM：只可编程一次
- 可擦除可编程只读存储器EPROM：可编程多次，可擦除
- 电可擦除可编程只读存储器$E^2$PROM：
    - 可编程多次，可擦除
    - 需施加编程电压（12-24V）
    - 可在工作系统中在线进行

### 闪速存储器Flash Memory

- NOR Flash
    1. 读取速度块，可直接运行程序
    2. CPU可访问
    3. 写擦速度慢
    4. 耐久10万次
    5. 量小价高
    6. 常用作存放程序
- NAND Flash
    1. 速度较慢，程序先读入RAM才能运行
    2. CPU需专门控制器才能访问
    3. 写擦速度较快
    4. 耐久100万次
    5. 量大价低
    6. 常用作外部存储程序和数据

# 嵌入式存储器系统的结构

***L0：内部寄存器 -> L1：芯片高速缓存（Cache） —> L2：主存储器（SRAM、DRAM、SDRAM等） -> L3：主存储器(EPROM、NOR Flash) -> L4：外部存储器（NAND Flash、磁盘、光盘、SD卡等）***

- 存储容量：从小到大
- 访问速度：从快到慢

## 以S3C2440微处理器为例

### S3C2440存储器系统特性

- **支持小端/大端模式**：通过编程设定
- **可寻址外部存储空间为1GB**
  - 有27根地址线（ADDR0-ADDR26）
  - 有8根片选线（nGCS0-nGCS7）
- **外部存储分为8个Bank（Bank0 ~ Bank7）**
  - 每个Bank为128MB
  - 总共为（8 × 128MB = 1024MB = 1GB）
- **Bank0的数据总线宽度只能为16位或32位**（由引脚电平决定）
  - 其他Bank（Bank1-Bank7）可编程为8位、16位或32位
- **Bank0 ~ Bank5可以接ROM和SRAM类型存储器**
  - **Bank6和Bank7可以接ROM、SRAM和SDRAM类型存储器**
- **Bank6和Bank7的大小可以编程**
- **Bank0 ~ Bank6有固定的起始地址**
  - **Bank7的起始地址 = Bank6的结束地址 + 1**
- **所有Bank的访问周期都可以编程**

### Bank 0

#### 由S3C2440芯片的OM(Operation Mode)引脚决定

| OM₁(操作模式1) | OM₀(操作模式0) | 启动ROM 的数据宽度 |
| :------------- | :------------- | :----------------- |
| **0** | **0** | **NAND Flash 模式** |
| **0** | **1** | **16 位** |
| **1** | **0** | **32 位** |
| **1** | **1** | **测试模式** |

> **说明**：
> - **OM引脚**：Operation Mode引脚，用于配置S3C2440的启动模式
> - **NAND Flash模式**：从NAND Flash启动，数据宽度由NAND Flash控制器决定
> - **16位模式**：从外部ROM启动，数据总线宽度为16位
> - **32位模式**：从外部ROM启动，数据总线宽度为32位
> - **测试模式**：用于芯片测试和调试

- 外接SRAM或ROM类型存储器
- NOR Flash引导系统启动时，通常配置到Bank0。

### 其它Bank

- 宽度应设定为8位、16位或32位
- 可以外接SRAM类型的存储器或者具有SDRAM接口特性的ROM存储器，并且可以外接SDRAM类型的存储器。
- Bank6、Bank7容量可以编程设定。

# 外部存储器芯片连接

8位、16位、32位：从左到右性能变高，价格变高，功耗变高

## 微处理器芯片与外部存储器的连接

本质上是三种总线的连接

- 数据总线的连接：将存储器数据引脚与微处理器芯片的数据引脚顺序链接
- 控制总线的连接：将...控制引脚与...连接
- 地址总线的连接：与(存储)系统数据总线的位数有关。

| 存储器芯片的地址引脚 | 8位存储系统<br/>S3C2440的地址引脚 | 16位存储系统<br/>S3C2440的地址引脚 | 32位存储系统<br/>S3C2440的地址引脚 |
| :------------------- | :-------------------------------- | :---------------------------------- | :---------------------------------- |
| **A0** | **A0** | **A1** | **A2** |
| **A1** | **A1** | **A2** | **A3** |
| **...** | **...** | **...** | **...** |

> **说明**：
> - **地址偏移**：不同数据总线宽度下，S3C2440的地址引脚与存储器芯片地址引脚的连接存在偏移
> - **8位系统**：地址引脚直接对应（A0→A0, A1→A1）
> - **16位系统**：地址引脚偏移1位（A0→A1, A1→A2），A0用于字节选择
> - **32位系统**：地址引脚偏移2位（A0→A2, A1→A3），A0和A1用于字节选择
> - **字节选择**：S3C2440的低位地址线用于选择多字节数据中的具体字节：与系统数据总线的位数有关

## 存储器芯片连接实例

### 8位存储器芯片构成8位存储器系统

- 存储器的8位数据线$DQ_7$ ~ $DQ_0$与S3C2440 的低8位数据总线$DATA_7$ ~ $DATA_0$相连
- 存储器地址线...$A_1$、$A_0$与SC2440地址总线...$ADDR_1$、$ADDR_0$
- 存储器的允许输出信号nOE端接S3C2440的nOE引脚
- 存储器的写输出信号nWE端接S3C2440的nWE引脚
- 存储器的片选输出信号nCE端接S3C2440的nGCSn引脚

### 8位存储器芯片并联构成16位存储器系统

- 分低8位和高8位分别连接
- 地址线连$ADDR_n$
- 允许输出信号nOE连nOE
- 低八位nWE连$nWBE_0$，高八位nWE连$nWBE_1$
- nCE都连$nGCGn$

### 16位存储器芯片构成16位存储器系统

与前面多了：

- SRAM存储器：需存储器nUB、nLB连S3C2440的$nBE_1$、$nBE_0$引脚
- SDRAM存储器：需保证下表

| 信号名称 | 指示符 | 描述 |
| :------- | :----- | :--- |
| nSRAS | O | SDRAM 行地址选通 |
| nSCAS | O | SDRAM 列地址选通 |
| nSCS[1:0] | O | SDRAM 片选 |
| DQM[3:0] | O | SDRAM 数据屏蔽 |
| SCLK[1:0] | O | SDRAM 时钟 |
| SCKE | O | SDRAM 时钟使能 |

# NOR Flash存储器芯片及其连接

通常配置到Bank0。

## SST39VF1601

- 存储容量2MB。以半字模式工作
- 工作电压2.7 ~ 3.6V。
- 采用48脚TSOP封装或48脚TFBG封装

| 引脚 | 类型 | 描述 |
| :--- | :--- | :--- |
| A[19:0] | I | 20根地址总线A19~A0。 |
| DQ[15:0] | I/O (有三态功能) | 数据总线,在读/写操作时提供16位的数据总线宽度 |
| /CE | I | 片选信号,低电平有效。当对SST39VF1601进行读/写操作时,该引脚必须为低电平;当为高电平时,芯片处于高阻状态。 |
| /OE | I | 允许输出使能,低电平有效。 |
| /WE | I | 写使能,低电平有效。当对SST39VF1601进行编程和擦除操作时,控制相应的写命令。 |
| VDD | - | 3.3V电源。 |
| VSS | - | 接地。 |

## NOR Flash存储器的接口电路

- 微处理器芯片的$OM_1$引脚接地，$OM_0$引脚接高电平
- SST39VF3201：4MB，$A_{20}$有效，接微处理器$ADDR_{21}$
- SST39VF6401：8MB，$A_{21}$、$A_{20}$有效，接微处理器$ADDR_{22}$、$ADDR_{21}$

# NAND Flash存储器芯片及其连接

- 擦写速度很快，存储密度大，价格低
- 使用需要I/O接口电路和存储管理操作。
> 以页为最小单位读写，块最小来擦除。
- 支持自动启动引导

## 8位NAND Flash控制器

- I/O引脚：用于输出地址、输出命令、输入/输出数据。
- 控制引脚：CLE命令锁存使能、ALE地址锁存使能、